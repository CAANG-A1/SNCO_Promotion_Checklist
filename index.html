<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SNCO Promotion Review Terminal</title>
    <!-- Core Dependencies -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
        
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #f1f5f9;
            position: relative;
        }

        @media print {
            .no-print { display: none !important; }
            body { background: white !important; padding: 0 !important; color: black !important; }
            .print-only { display: block !important; }
            .max-w-6xl { max-width: none !important; width: 100% !important; margin: 0 !important; }
        }

        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }

        #guidance-popup {
            pointer-events: none;
            transition: opacity 0.1s ease-in-out, transform 0.1s cubic-bezier(0.16, 1, 0.3, 1);
            z-index: 5000;
            transform: translateY(10px);
        }

        .modal-overlay {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(4px);
        }

        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
    </style>
</head>
<body class="text-slate-900 min-h-screen p-4 md:p-8 text-[13px]">

    <!-- FLOATING GUIDANCE POPUP -->
    <div id="guidance-popup" class="hidden opacity-0 absolute bg-slate-900 text-white p-4 rounded-2xl shadow-2xl max-w-xs text-[11px] font-medium leading-relaxed border border-white/10 no-print">
        <div class="flex items-center gap-2 mb-2 border-b border-white/10 pb-2">
            <i data-lucide="shield-check" class="w-4 h-4 text-blue-400"></i>
            <span class="font-black uppercase tracking-widest text-blue-400 text-[10px]">Policy Guidance</span>
        </div>
        <p id="guidance-text" class="text-slate-300"></p>
        <div class="absolute left-6 -bottom-2 w-4 h-4 bg-slate-900 rotate-45 border-r border-b border-white/10"></div>
    </div>

    <!-- PRINT PREVIEW MODAL -->
    <div id="print-modal" class="hidden fixed inset-0 z-[2000] flex items-center justify-center p-4 md:p-12 modal-overlay no-print">
        <div class="bg-white w-full max-w-5xl h-full rounded-[40px] shadow-2xl overflow-hidden flex flex-col animate-in zoom-in-95 duration-300">
            <div class="p-6 border-b border-slate-200 flex justify-between items-center bg-white shrink-0">
                <div class="flex items-center gap-3">
                    <div class="p-2 bg-blue-600 rounded-lg text-white"><i data-lucide="file-text" class="w-5 h-5"></i></div>
                    <h2 class="font-black uppercase italic tracking-tighter text-slate-800 text-lg">Document Preview</h2>
                </div>
                <div class="flex gap-3">
                    <button onclick="closePrintPreview()" class="px-6 py-2 rounded-xl text-xs font-bold text-slate-500 hover:bg-slate-100 transition-all uppercase tracking-widest">Close</button>
                    <button onclick="window.print()" class="px-8 py-2 bg-blue-600 text-white rounded-xl text-xs font-black shadow-lg hover:bg-blue-700 transition-all uppercase tracking-widest flex items-center gap-2">
                        <i data-lucide="printer" class="w-4 h-4"></i> Finalize & Print
                    </button>
                </div>
            </div>
            <div class="flex-1 overflow-y-auto p-12 bg-slate-200/50 flex justify-center custom-scrollbar">
                <div class="bg-white w-[8.5in] min-h-[11in] shadow-2xl p-16 pb-32 space-y-10 uppercase text-slate-900 flex flex-col text-xs font-bold">
                    <div class="text-center border-b-4 border-slate-900 pb-8 shrink-0">
                        <h2 class="text-3xl font-black italic tracking-tighter underline decoration-blue-600 underline-offset-8">Promotion Certification</h2>
                        <p class="text-[10px] font-bold tracking-[0.2em] mt-4 opacity-50">California Air National Guard | Official Review Record</p>
                    </div>

                    <div class="grid grid-cols-2 gap-8 font-black border-b border-slate-100 pb-8 shrink-0">
                        <div class="space-y-4">
                            <div><p class="text-[9px] text-slate-400 mb-0.5">Candidate</p><p id="prev-name" class="text-xs font-black h-4"></p></div>
                            <div><p class="text-[9px] text-slate-400 mb-0.5">Target Rank</p><p id="prev-rank" class="text-xs font-black h-4"></p></div>
                        </div>
                        <div class="space-y-4">
                            <div><p class="text-[9px] text-slate-400 mb-0.5">Assigned Unit</p><p id="prev-unit" class="text-xs font-black h-4"></p></div>
                            <div><p class="text-[9px] text-slate-400 mb-0.5">Review Status</p><p id="prev-status" class="text-xs font-black h-4"></p></div>
                        </div>
                    </div>

                    <div class="flex-1 space-y-8">
                        <div class="space-y-3">
                            <h3 class="text-xs font-black border-l-4 border-blue-600 pl-3 uppercase italic">Compliance Audit & Evidence</h3>
                            <div class="border border-slate-100 rounded-2xl overflow-hidden">
                                <table class="w-full text-[9px]">
                                    <thead class="bg-slate-50 font-black border-b border-slate-100">
                                        <tr>
                                            <th class="px-4 py-2 text-left w-1/3">Qualification Category</th>
                                            <th class="px-4 py-2 text-left">Evidence / Policy Requirement</th>
                                            <th class="px-4 py-2 text-center w-16 text-xs">Status</th>
                                        </tr>
                                    </thead>
                                    <tbody id="prev-audit-table-body" class="divide-y divide-slate-100 font-medium normal-case text-slate-700"></tbody>
                                </table>
                            </div>
                        </div>

                        <div class="space-y-3 shrink-0">
                            <h3 class="text-xs font-black border-l-4 border-blue-600 pl-3 uppercase italic">Reviewer Remarks</h3>
                            <div class="p-4 bg-slate-50 border border-slate-200 rounded-xl max-w-full">
                                <p id="prev-comments" class="text-[10px] normal-case leading-relaxed italic text-slate-700 whitespace-pre-wrap break-words overflow-hidden min-h-[40px]"></p>
                            </div>
                        </div>
                    </div>

                    <div class="mt-auto pt-16 grid grid-cols-2 gap-16 shrink-0 pb-12">
                        <div class="space-y-12">
                            <div class="border-b-2 border-slate-900 pb-2">
                                <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest leading-none mb-1">Reviewer Name/Rank</p>
                                <p id="prev-reviewer-info" class="text-[11px] font-black mt-1 h-4"></p>
                            </div>
                            <div class="border-b-2 border-slate-900 pb-2">
                                <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest leading-none mb-1">Digital Signature / Date</p>
                                <div class="h-4"></div>
                            </div>
                        </div>
                        <div class="bg-slate-50 border-2 border-dashed border-slate-200 rounded-3xl flex flex-col items-center justify-center p-8 text-center min-h-[140px]">
                            <i data-lucide="shield-check" class="w-12 h-12 text-slate-200 mb-4"></i>
                            <p class="text-[10px] font-bold text-slate-300 uppercase tracking-widest leading-tight">Official Verification Stamp Area</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="max-w-6xl mx-auto space-y-6">
        <header class="bg-white rounded-[32px] shadow-sm border border-slate-200 p-6 flex justify-between items-center no-print">
            <div class="flex items-center gap-4">
                <div class="w-14 h-14 bg-slate-900 rounded-2xl flex items-center justify-center text-white shadow-xl shadow-slate-900/20">
                    <i data-lucide="shield-check" class="w-8 h-8"></i>
                </div>
                <div>
                    <h1 class="text-2xl font-black tracking-tight uppercase italic tracking-tighter leading-none">SNCO Promotion Terminal</h1>
                    <p class="text-[10px] text-slate-500 font-bold uppercase tracking-widest mt-1">California Air National Guard | Compliance Engine</p>
                </div>
            </div>
            <div class="flex gap-2">
                <button onclick="openPrintPreview()" class="px-6 py-2.5 bg-blue-600 text-white hover:bg-blue-700 rounded-xl text-xs font-black flex items-center gap-2 uppercase tracking-widest transition-all shadow-lg shadow-blue-900/10">
                    <i data-lucide="printer" class="w-4 h-4"></i> Print Review
                </button>
                <button onclick="location.reload()" class="p-3 text-slate-400 hover:text-red-500 transition-colors">
                    <i data-lucide="trash-2" class="w-5 h-5"></i>
                </button>
            </div>
        </header>

        <div class="bg-white rounded-[32px] shadow-sm border border-slate-200 p-8 no-print">
            <div id="stepper-container" class="flex justify-between items-start max-w-3xl mx-auto"></div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 items-stretch no-print">
            <div class="lg:col-span-8 bg-white rounded-[40px] shadow-sm border border-slate-200 flex flex-col overflow-hidden relative min-h-[650px]">
                <div class="flex-1 p-6 md:p-10">
                    
                    <!-- STEP 1 -->
                    <div id="step-1" class="snco-step space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500">
                        <div class="border-b border-slate-100 pb-4">
                            <h2 class="text-2xl font-black tracking-tight uppercase italic tracking-tighter">1. Member Identification</h2>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="space-y-2">
                                <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Candidate Name</label>
                                <input type="text" id="prof-name" oninput="sncoUpdateField('profile', 'name', this.value)" class="guidance-trigger w-full bg-slate-50 border border-slate-200 rounded-2xl p-4 font-bold uppercase outline-none focus:ring-2 focus:ring-blue-500" placeholder="DOE, JANE A">
                            </div>
                            <div class="space-y-2">
                                <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Assigned Unit</label>
                                <input type="text" id="prof-unit" oninput="sncoUpdateField('profile', 'unit', this.value)" class="guidance-trigger w-full bg-slate-50 border border-slate-200 rounded-2xl p-4 font-bold uppercase outline-none focus:ring-2 focus:ring-blue-500" placeholder="144 FW / FSS">
                            </div>
                            <div class="space-y-2">
                                <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Target Rank</label>
                                <select id="prof-rank" onchange="sncoUpdateField('profile', 'targetRank', this.value)" class="guidance-trigger w-full bg-slate-50 border border-slate-200 rounded-2xl p-4 font-bold outline-none">
                                    <option value="TSgt">TSgt (E-6)</option>
                                    <option value="MSgt" selected>MSgt (E-7)</option>
                                    <option value="SMSgt">SMSgt (E-8)</option>
                                    <option value="CMSgt">CMSgt (E-9)</option>
                                </select>
                            </div>
                            <div class="space-y-2">
                                <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Program Logic</label>
                                <select id="prof-package" onchange="sncoUpdateField('profile', 'packageType', this.value)" class="guidance-trigger w-full border-2 bg-slate-50 border-slate-200 rounded-2xl p-4 font-bold outline-none text-blue-600">
                                    <option value="Standard">Standard Vacancy</option>
                                    <option value="STEP_I">STEP I (E6/E7)</option>
                                    <option value="STEP_II">STEP II (E8/E9)</option>
                                    <option value="Retraining">Retraining Promotion</option>
                                </select>
                            </div>

                            <div class="space-y-2 md:col-span-2 p-6 bg-blue-50 rounded-[32px] border border-blue-100 flex flex-col md:flex-row gap-6 items-center">
                                <div class="flex-1 space-y-1">
                                    <label class="text-[10px] font-black text-blue-600 uppercase tracking-widest block">HQ Submission Date</label>
                                    <p class="text-[10px] text-slate-400 font-medium italic leading-tight italic">Policy: Member must remain current through end of following month.</p>
                                </div>
                                <input type="date" id="readiness-submissionDate" oninput="sncoUpdateField('readiness', 'submissionDate', this.value)" class="guidance-trigger w-full md:w-auto bg-white border border-blue-200 rounded-2xl p-4 text-sm font-bold outline-none">
                            </div>

                            <div class="space-y-3 md:col-span-2">
                                <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Component Status</label>
                                <div id="component-toggle" class="flex flex-wrap bg-slate-100 rounded-xl p-1 gap-1"></div>
                            </div>
                        </div>
                    </div>

                    <!-- STEP 2 -->
                    <div id="step-2" class="snco-step hidden space-y-6 animate-in fade-in slide-in-from-right-4 duration-500">
                        <div class="border-b border-slate-100 pb-4">
                            <h2 class="text-2xl font-black tracking-tight uppercase tracking-tighter italic leading-none">2. Service & Prof. Development</h2>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div class="space-y-4">
                                <div class="space-y-1">
                                    <label id="tis-label" class="guidance-trigger text-[10px] font-black text-slate-400 uppercase tracking-widest block mb-1">Pay Entry Date</label>
                                    <input type="date" id="service-payDate" oninput="sncoUpdateField('service', 'payDate', this.value)" class="guidance-trigger w-full bg-slate-50 border border-slate-200 rounded-2xl p-3 text-sm font-bold outline-none">
                                </div>
                                <div class="space-y-1">
                                    <label id="tig-label" class="guidance-trigger text-[10px] font-black text-slate-400 uppercase tracking-widest block mb-1">Date of Rank</label>
                                    <input type="date" id="service-dor" oninput="sncoUpdateField('service', 'dor', this.value)" class="guidance-trigger w-full bg-slate-50 border border-slate-200 rounded-2xl p-3 text-sm font-bold outline-none">
                                </div>
                                <div class="space-y-1">
                                    <label id="epb-label" class="guidance-trigger text-[10px] font-black text-slate-400 uppercase tracking-widest italic block mb-1">Latest EPB Closeout Date</label>
                                    <input type="date" id="service-epbDate" oninput="sncoUpdateField('service', 'epbDate', this.value)" class="guidance-trigger w-full bg-blue-50 border border-blue-100 rounded-2xl p-3 text-sm font-bold outline-none transition-all">
                                </div>

                                <div class="bg-slate-900 rounded-[32px] p-6 space-y-4 shadow-xl">
                                    <h3 class="text-[10px] font-black text-blue-400 uppercase tracking-widest flex items-center gap-2">
                                        <i data-lucide="graduation-cap" class="w-4 h-4"></i> Professional Development
                                    </h3>
                                    <div class="space-y-3">
                                        <div id="row-ncoa" class="flex items-center justify-between p-3 bg-slate-800 rounded-xl border border-slate-700 cursor-pointer transition-all hover:bg-slate-700" onclick="sncoTogglePME('NCOA')">
                                            <span class="text-[10px] font-bold text-slate-300 uppercase tracking-tight">NCOA Complete?</span>
                                            <div id="check-ncoa" class="w-5 h-5 rounded-lg border-2 border-slate-600 flex items-center justify-center transition-all bg-slate-900"></div>
                                        </div>
                                        <div id="row-sncoa" class="flex items-center justify-between p-3 bg-slate-800 rounded-xl border border-slate-700 cursor-pointer transition-all hover:bg-slate-700" onclick="sncoTogglePME('SNCOA')">
                                            <span class="text-[10px] font-bold text-slate-300 uppercase tracking-tight">SNCOA Complete?</span>
                                            <div id="check-sncoa" class="w-5 h-5 rounded-lg border-2 border-slate-600 flex items-center justify-center transition-all bg-slate-900"></div>
                                        </div>
                                        <div id="row-degree" class="flex items-center justify-between p-3 bg-slate-800 rounded-xl border border-slate-700 cursor-pointer transition-all hover:bg-slate-700" onclick="sncoToggleDegree()">
                                            <span class="text-[10px] font-bold text-slate-300 uppercase tracking-tight">CCAF / Associate Degree?</span>
                                            <div id="check-degree" class="w-5 h-5 rounded-lg border-2 border-slate-600 flex items-center justify-center transition-all bg-slate-900"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="space-y-4">
                                <div id="tafms-container" class="p-6 rounded-[40px] space-y-4 shadow-xl border-4 transition-all min-h-[160px] flex flex-col justify-center"></div>
                                <div class="p-6 bg-slate-50 rounded-[32px] border border-slate-200 space-y-4 shadow-inner">
                                    <div class="flex justify-between items-center border-b pb-2">
                                        <h3 class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Skill Level Audit</h3>
                                        <span id="slot-req-badge" class="bg-blue-600 text-white text-[8px] font-black px-2 py-0.5 rounded-full uppercase italic"></span>
                                    </div>
                                    <div class="space-y-4 text-xs">
                                        <div class="space-y-1">
                                            <label class="text-[9px] font-bold text-slate-500 uppercase">Awarded PAFSC Level</label>
                                            <select id="service-pafsc" onchange="sncoUpdateField('service', 'pafscLevel', this.value)" class="w-full bg-white border border-slate-200 rounded-xl p-3 text-xs font-black text-slate-900">
                                                <option value="1">1</option><option value="3">3</option><option value="5">5</option><option value="7" selected>7</option><option value="9">9</option>
                                            </select>
                                        </div>
                                        <div class="space-y-1">
                                            <label id="dafsc-label" class="guidance-trigger text-[9px] font-bold text-slate-500 uppercase tracking-tight leading-tight">Member's Awarded Skill Level in Current Duty (DAFSC)</label>
                                            <select id="service-dafsc" onchange="sncoUpdateField('service', 'dafscLevel', this.value)" class="w-full bg-white border border-slate-200 rounded-xl p-3 text-xs font-black text-slate-900">
                                                <option value="1">1</option><option value="3">3</option><option value="5">5</option><option value="7" selected>7</option><option value="9">9</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- STEP 3 -->
                    <div id="step-3" class="snco-step hidden space-y-6 animate-in fade-in slide-in-from-right-4 duration-500">
                        <div class="border-b border-slate-100 pb-4">
                            <h2 class="text-2xl font-black tracking-tight uppercase tracking-tighter italic leading-none">3. Readiness & Fitness Review</h2>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div class="space-y-4">
                                <div class="grid grid-cols-2 gap-4">
                                    <div class="space-y-1">
                                        <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest block mb-1">Fitness Score</label>
                                        <input type="number" id="readiness-fitScore" oninput="sncoUpdateField('readiness', 'fitScore', this.value)" class="guidance-trigger w-full bg-slate-50 border border-slate-200 rounded-xl p-3 font-bold outline-none text-slate-900" placeholder="0-100">
                                    </div>
                                    <div class="space-y-1">
                                        <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest block mb-1">Status</label>
                                        <select id="readiness-fitStatus" onchange="sncoUpdateField('readiness', 'fitStatus', this.value)" class="w-full bg-slate-50 border border-slate-200 rounded-xl p-3 text-xs font-bold outline-none text-slate-900">
                                            <option value="Passing">Passing</option><option value="Failing">Failing</option><option value="Exempt">Exempt</option><option value="Pregnancy">Pregnancy Exemption</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="space-y-1">
                                    <label id="fit-exp-label" class="guidance-trigger text-[10px] font-black text-slate-400 uppercase tracking-widest block mb-1">Fitness Expiration Date</label>
                                    <input type="date" id="readiness-fitExpirationDate" oninput="sncoUpdateField('readiness', 'fitExpirationDate', this.value)" class="guidance-trigger w-full border-2 rounded-xl p-3 font-bold outline-none bg-slate-50 border-slate-200 transition-all text-slate-900">
                                </div>
                                <div id="fit-currency-box" class="p-4 rounded-2xl border bg-slate-50 space-y-1 shadow-inner">
                                    <p class="text-[8px] font-black text-slate-400 uppercase tracking-widest">Compliance Window Target</p>
                                    <p id="fit-currency-target" class="text-[11px] font-bold text-slate-600">Calculated based on submission date...</p>
                                </div>
                            </div>
                            <div class="space-y-4">
                                <div class="space-y-1">
                                    <label id="security-label" class="guidance-trigger text-[10px] font-black text-slate-400 uppercase tracking-widest block mb-1 uppercase italic">Security Adjudication Date</label>
                                    <input type="date" id="clearance-input" oninput="sncoUpdateField('readiness', 'clearanceDate', this.value)" class="guidance-trigger w-full border-2 rounded-xl p-3 font-bold outline-none bg-slate-50 border border-slate-200 transition-all text-slate-900">
                                </div>
                                <div class="bg-slate-50 p-6 rounded-[32px] border border-slate-200 space-y-4 shadow-inner text-slate-400 font-black text-[10px] uppercase">
                                    <p class="border-b pb-2 italic">Administrative Holds</p>
                                    <div id="admin-flags" class="space-y-3 pt-2"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- STEP 4 -->
                    <div id="step-4" class="snco-step hidden space-y-8 animate-in fade-in slide-in-from-right-4 duration-500">
                        <div class="border-b border-slate-100 pb-4">
                            <h2 class="text-2xl font-black tracking-tight uppercase tracking-tighter italic leading-none">4. Verification & Reviewer Profile</h2>
                        </div>
                        <div class="space-y-8">
                            <div class="bg-slate-50 p-8 rounded-[40px] border border-slate-200 shadow-inner space-y-6">
                                <h3 class="font-black text-xs uppercase text-blue-600 flex items-center gap-3"><i data-lucide="clipboard-list" class="w-5 h-5"></i> Folder Checklist</h3>
                                <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
                                    <div class="lg:col-span-5">
                                        <div id="board-comp-box" class="guidance-trigger p-4 bg-white rounded-3xl border border-slate-200 shadow-sm flex items-center justify-between cursor-pointer h-20 transition-all hover:border-blue-300" onclick="sncoToggleComposition()" tabindex="0">
                                            <div class="space-y-1">
                                                <p class="text-[10px] font-black uppercase text-slate-700 tracking-tighter">Board Composition OK?</p>
                                                <p id="board-req-text" class="text-[11px] font-black text-blue-600 leading-tight"></p>
                                            </div>
                                            <input type="checkbox" id="board-comp-checkbox" class="w-6 h-6 rounded text-blue-600 pointer-events-none">
                                        </div>
                                    </div>
                                    <div id="folder-checklist" class="lg:col-span-7 grid grid-cols-1 md:grid-cols-2 gap-2"></div>
                                </div>
                            </div>
                            <div class="bg-slate-50 p-8 rounded-[40px] border border-slate-200 shadow-inner space-y-6">
                                <h3 class="font-black text-xs uppercase text-blue-600 flex items-center gap-3"><i data-lucide="user-check" class="w-5 h-5"></i> Certifying Reviewer Details</h3>
                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <div class="md:col-span-3">
                                            <label class="text-[9px] font-black text-slate-400 uppercase tracking-widest block mb-1">Full Name</label>
                                            <input type="text" id="rev-name" oninput="sncoUpdateField('reviewer', 'name', this.value)" class="guidance-trigger w-full bg-white border border-slate-200 rounded-xl p-3 text-xs font-bold outline-none text-slate-900" placeholder="DOE, JOHN B">
                                        </div>
                                        <div class="md:col-span-1 text-xs">
                                            <label class="text-[9px] font-black text-slate-400 uppercase tracking-widest block mb-1">Rank</label>
                                            <input type="text" id="rev-rank" oninput="sncoUpdateField('reviewer', 'rank', this.value)" class="guidance-trigger w-full bg-white border border-slate-200 rounded-xl p-3 text-xs font-bold outline-none text-slate-900" placeholder="SMSGT">
                                        </div>
                                        <div class="md:col-span-2 text-xs">
                                            <label class="text-[9px] font-black text-slate-400 uppercase tracking-widest block mb-1">Unit</label>
                                            <input type="text" id="rev-unit" oninput="sncoUpdateField('reviewer', 'unit', this.value)" class="guidance-trigger w-full bg-white border border-slate-200 rounded-xl p-3 text-xs font-bold outline-none text-slate-900" placeholder="144 FSS / MPF">
                                        </div>
                                    </div>
                                    <div>
                                        <label class="text-[9px] font-black text-slate-400 uppercase tracking-widest block mb-1 text-slate-400 leading-none mb-1">Remarks</label>
                                        <textarea id="rev-comments" oninput="sncoUpdateField('reviewer', 'comments', this.value)" class="guidance-trigger w-full bg-white border border-slate-200 rounded-xl p-3 text-[10px] font-medium min-h-[105px] outline-none text-slate-900" placeholder="Enter findings, waiver notes, etc..."></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-slate-50 p-6 border-t border-slate-100 flex justify-between items-center shrink-0">
                    <button id="prev-btn" onclick="sncoChangeStep(-1)" class="px-8 py-3 text-xs font-black text-slate-400 uppercase tracking-widest hover:text-slate-600 transition-colors disabled:opacity-30">
                        <i data-lucide="chevron-left" class="inline-block w-4 h-4 mr-1"></i> Back
                    </button>
                    <div class="flex gap-4">
                        <button id="first-sgt-btn" onclick="sncoToggleFirstSgt()" class="guidance-trigger px-4 py-2 rounded-xl text-[10px] font-black uppercase border-2 transition-all">1st Sgt Mode: OFF</button>
                        <button id="next-btn" onclick="sncoChangeStep(1)" class="px-10 py-3 bg-blue-600 text-white rounded-xl text-xs font-black shadow-lg hover:bg-blue-700 transition-all uppercase tracking-widest flex items-center gap-2 text-sm">
                            <span>Continue</span> <i data-lucide="chevron-right" class="w-4 h-4"></i>
                        </button>
                        <div id="final-status-badge" class="hidden px-10 py-3 rounded-xl font-black text-xs uppercase tracking-widest shadow-lg transition-all"></div>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-4 flex flex-col h-full no-print">
                <div class="bg-white rounded-[40px] p-8 border border-slate-200 shadow-sm flex-1 flex flex-col max-h-[850px] sticky top-8 overflow-hidden">
                    <div class="flex items-center gap-2 mb-6 border-b border-slate-50 pb-4 shrink-0 uppercase italic font-black text-slate-400">
                        <i data-lucide="layout-dashboard" class="w-5 h-5 text-blue-600"></i>
                        <h3 class="text-xs font-black uppercase tracking-widest italic">Compliance Audit</h3>
                    </div>
                    <div id="audit-results" class="flex-1 space-y-3 custom-scrollbar overflow-y-auto pr-2"></div>
                    <div id="audit-summary-card" class="mt-6 p-6 rounded-3xl border-2 transition-all duration-500 shrink-0 bg-slate-50 border-slate-100">
                        <p class="text-[9px] font-black uppercase text-slate-400 tracking-widest mb-1 leading-none uppercase">Global Verdict</p>
                        <p id="audit-summary-verdict" class="text-xl font-black italic tracking-tighter italic text-slate-900">PENDING</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // GLOBAL HELPERS
        const el = (id) => document.getElementById(id);

        const guidanceMap = {
            'prof-name': "MIL-STANDARD: Member's name in 'LAST, FIRST MI' format as it appears in MILPDS.",
            'prof-rank': "RANK SELECTION: Target grade. Promotion eligibility depends on awarded AFSC skill level and position availability.",
            'prof-package': "LOGIC TYPE: Standard (Vacancy promotion), STEP I (Accelerated E6/E7), STEP II (Accelerated E8/E9), or Retraining (qualified AFSC but new duty).",
            'readiness-submissionDate': "HQ COMPLIANCE: AFI 36-2905. Member fitness must remain current through the last day of the month following the month this package is submitted.",
            'service-payDate': "PEBD (AFI 36-2502): Basis for Time in Service (TIS). Member must meet minimum TIS thresholds for the target grade.",
            'service-dor': "TIG (AFI 36-2502): Basis for Time in Grade. Member must meet 24-month TIG for MSgt through CMSgt promotions.",
            'service-epbDate': "PERFORMANCE (DAFI 36-2406): AGRs must have a closeout within 12 months; DSGs within 24 months of the submission window.",
            'clearance-input': "SECURITY (DAFI 31-501): Valid clearance must be adjudicated within 5 years. If aged over 5 years, a validity memo is mandatory.",
            'board-comp-box': "BOARD COMPOSITION (AFI 36-2502): MSgt: Min 2 MSgts + 1 SMSgt. SMSgt/CMSgt: Min 3 CMSgts (incl. Wing CCM). STEP boards require CCM level oversight.",
            'tis-label': "TIS ELIGIBILITY: MSgt: 8 yrs; SMSgt: 11 yrs; CMSgt: 14 yrs of Satisfactory Service (DSG) or TAFMS (AGR).",
            'tig-label': "TIG ELIGIBILITY: AFI 36-2502 requires a minimum of 24 months in current grade for promotion to E-7, E-8, and E-9.",
            'epb-label': "EVALUATION CYCLE: Packages require the most current performance report. Out-of-cycle evaluations block processing until corrected.",
            'security-label': "VALIDITY: Clearances aged over 5 years (60 months) from adjudication date require a standard Security Validity Memo for HQ acceptance.",
            'fit-exp-label': "FITNESS EXPIRATION: AFI 36-2905 requires currency through the entirety of the processing window (Submission Month + 1).",
            'first-sgt-btn': "SPECIAL DUTY: First Sergeants must acknowledge specialized SOUs regarding their diamond position and retraining timelines.",
            'dafsc-label': "DUTY QUALIFICATION: Select the Member's actual awarded skill level in their current Duty AFSC. Retraining promotions require at least a 3-level in Duty AFSC."
        };

        const standards = {
            TSgt: { minTis: 72, minTig: 24, skill: 7, tisLabel: '6 Yrs', pme: [], composition: "2 TSgts and 1 MSgt" },
            MSgt: { minTis: 96, minTig: 24, skill: 7, pme: ['NCOA'], tisLabel: '8 Yrs', composition: "Min 2 MSgts and 1 SMSgt", stepComposition: "Wing CCM + 2 SNCOs" },
            SMSgt: { minTis: 132, minTig: 24, skill: 7, pme: ['SNCOA'], degree: true, tisLabel: '11 Yrs', composition: "Min 2 SMSgts and 1 CMSgt", stepComposition: "State CCM + Wing CCMs" },
            CMSgt: { minTis: 168, minTig: 24, skill: 9, pme: ['SNCOA'], degree: true, tisLabel: '14 Yrs', composition: "3 CMSgts (inc. Wing CCM)", stepComposition: "State CCM + Wing CCMs" },
        };

        let sncoState = {
            currentStep: 1,
            isFirstSgt: false,
            profile: { name: '', unit: '', component: 'DSG', targetRank: 'MSgt', packageType: 'Standard' },
            reviewer: { name: '', rank: '', unit: '', comments: '' },
            service: { 
                dor: '', payDate: '', tafmsYears: '', tafmsMonths: '', satYears: '', satMonths: '', epbDate: '', pafscLevel: '7', dafscLevel: '7',
                pmeComplete: { NCOA: false, SNCOA: false },
                degreeComplete: false
            },
            readiness: { 
                fitScore: '', fitExpirationDate: '', submissionDate: '', fitStatus: 'Passing',
                clearanceDate: '', adminHolds: { demotion: false, retirement: false, suspended: false } 
            },
            board: { compositionMet: false },
            checklist: { ca26: false, sou: false, memo: false, epb: false, fit: false, sec_clearance: false, retrain_sou: false, first_sgt_sou: false, af1206: false, bio: false, step2_sou: false }
        };

        function getEndOfFollowingMonth(dateString) {
            if (!dateString) return null;
            const date = new Date(dateString + 'T00:00:00');
            if (isNaN(date.getTime())) return null;
            date.setMonth(date.getMonth() + 2);
            date.setDate(0);
            return date;
        }

        function setupGuidanceSystem() {
            const popup = el('guidance-popup');
            const textEl = el('guidance-text');
            if (!popup || !textEl) return;
            const show = (t) => {
                const text = guidanceMap[t.id];
                if (text) {
                    textEl.innerText = text;
                    popup.classList.remove('hidden');
                    void popup.offsetHeight;
                    const r = t.getBoundingClientRect();
                    popup.style.left = `${r.left + window.scrollX}px`;
                    popup.style.top = `${r.top + window.scrollY - popup.offsetHeight - 12}px`;
                    popup.classList.add('opacity-100');
                    popup.style.transform = 'translateY(0)';
                }
            };
            const hide = () => { if(popup) { popup.classList.remove('opacity-100'); popup.style.transform = 'translateY(10px)'; } };
            document.addEventListener('focusin', (e) => { if(e.target.classList.contains('guidance-trigger')) show(e.target); });
            document.addEventListener('mouseover', (e) => {
                const trigger = e.target && e.target.closest && e.target.closest('.guidance-trigger');
                if (trigger) show(trigger);
            });
            document.addEventListener('focusout', hide);
            document.addEventListener('mouseout', (e) => {
                if (e.target && e.target.closest && e.target.closest('.guidance-trigger')) hide();
            });
            popup.addEventListener('transitionend', () => { if(popup && !popup.classList.contains('opacity-100')) popup.classList.add('hidden'); });
        }

        function formatYM(totalMonths) {
            if (!totalMonths && totalMonths !== 0) return "0 Yrs 0 Mos";
            const yrs = Math.floor(totalMonths / 12);
            const mos = totalMonths % 12;
            return `${yrs} Yr${yrs !== 1 ? 's' : ''} ${mos} Mo${mos !== 1 ? 's' : ''}`;
        }

        function calcMonths(date) {
            if (!date) return null;
            const d = new Date(date + 'T00:00:00');
            if (isNaN(d.getTime())) return null;
            const now = new Date();
            const diff = (now.getFullYear() - d.getFullYear()) * 12 + (now.getMonth() - d.getMonth());
            return Math.max(0, diff);
        }

        function sncoUpdateField(cat, field, val) { 
            if (cat && sncoState[cat]) sncoState[cat][field] = val; 
            sncoRender(); 
        }

        function sncoUpdateServiceValue(type, val) {
            const isAGR = sncoState.profile.component === 'AGR';
            if (type === 'Years') {
                if (isAGR) sncoState.service.tafmsYears = val;
                else sncoState.service.satYears = val;
            } else {
                if (isAGR) sncoState.service.tafmsMonths = val;
                else sncoState.service.satMonths = val;
            }
            sncoRender();
        }

        function sncoTogglePME(pme) { sncoState.service.pmeComplete[pme] = !sncoState.service.pmeComplete[pme]; sncoRender(); }
        function sncoToggleDegree() { sncoState.service.degreeComplete = !sncoState.service.degreeComplete; sncoRender(); }
        function sncoChangeStep(dir) { sncoState.currentStep = Math.max(1, Math.min(4, sncoState.currentStep + dir)); sncoRender(); }
        function sncoToggleAdminHold(id) { sncoState.readiness.adminHolds[id] = !sncoState.readiness.adminHolds[id]; sncoRender(); }
        function sncoToggleFirstSgt() { sncoState.isFirstSgt = !sncoState.isFirstSgt; sncoRender(); }
        function sncoToggleComposition() { sncoState.board.compositionMet = !sncoState.board.compositionMet; sncoRender(); }
        function sncoToggleCheck(id) { sncoState.checklist[id] = !sncoState.checklist[id]; sncoRender(); }

        function sncoGetMetrics() {
            const tis = calcMonths(sncoState.service.payDate);
            const tig = calcMonths(sncoState.service.dor);
            const epbAge = calcMonths(sncoState.service.epbDate);
            const clAge = calcMonths(sncoState.readiness.clearanceDate);
            const tafms = (parseInt(sncoState.service.tafmsYears) || 0) * 12 + (parseInt(sncoState.service.tafmsMonths) || 0);
            const sat = (parseInt(sncoState.service.satYears) || 0) * 12 + (parseInt(sncoState.service.satMonths) || 0);
            const fitTgt = getEndOfFollowingMonth(sncoState.readiness.submissionDate);
            const fitAct = sncoState.readiness.fitExpirationDate ? new Date(sncoState.readiness.fitExpirationDate + 'T00:00:00') : null;
            return { tis, tig, clAge, tafms, sat, fitTgt, fitAct, epbAge };
        }

        function sncoGetWarnings() {
            const m = sncoGetMetrics();
            const s = standards[sncoState.profile.targetRank];
            const isAGR = sncoState.profile.component === 'AGR';
            const pSkill = parseInt(sncoState.service.pafscLevel);
            const dSkill = parseInt(sncoState.service.dafscLevel);
            const reqSkill = s.skill;
            const isRetrain = (pSkill >= reqSkill && dSkill < reqSkill);
            const isStep = (sncoState.profile.packageType || "").startsWith('STEP');
            const isE8E9 = ['SMSgt', 'CMSgt'].includes(sncoState.profile.targetRank);
            
            const w = [];
            if (!sncoState.profile.name || !sncoState.profile.unit) w.push({ f: 'Incomplete', m: 'Name/Unit required.', t: 'error' });
            if (pSkill < s.skill) w.push({ f: 'Skill Level', m: `Ineligible: Awarded PAFSC < ${s.skill}-level.`, t: 'error' });
            if (isRetrain) {
                w.push({ f: 'Retraining', m: 'Retraining detected. SOU mandatory.', t: 'warning' });
                if (dSkill < 3) w.push({ f: 'Hard Stop', m: 'Ineligible: Needs 3-level in current Duty.', t: 'error' });
            }
            Object.entries(sncoState.readiness.adminHolds).forEach(([id, active]) => { if (active) w.push({ f: 'Hard Stop', m: `Member in ${id} status.`, t: 'error' }); });
            const tisVal = isAGR ? m.tafms : m.sat;
            if (tisVal < s.minTis) w.push({ f: 'Eligibility', m: `Needs ${s.tisLabel} ${isAGR ? 'TAFMS' : 'Satisfactory Service'}.`, t: 'error' });
            if (m.tig === null) w.push({ f: 'Incomplete', m: 'DOR missing.', t: 'error' });
            else if (m.tig < 24 && !sncoState.profile.targetRank.startsWith('T')) w.push({ f: 'TIG', m: 'Needs 24 Mos.', t: 'error' });
            if (m.epbAge === null) w.push({ f: 'Incomplete', m: 'EPB missing.', t: 'error' });
            else if (m.epbAge > (isAGR ? 12 : 24)) w.push({ f: 'EPB', m: 'Out of Cycle.', t: 'error' });
            if (sncoState.readiness.fitStatus === 'Failing') w.push({ f: 'Ineligible', m: 'Fitness Failing.', t: 'error' });
            if (sncoState.readiness.fitStatus === 'Pregnancy') w.push({ f: 'Fitness', m: 'Pregnancy exemption active.', t: 'warning' });
            if (m.fitTgt && m.fitAct && m.fitAct < m.fitTgt) w.push({ f: 'Fitness', m: 'Currency failure.', t: 'error' });
            if (!sncoState.readiness.clearanceDate) w.push({ f: 'Security', m: 'Adjudication missing.', t: 'error' });
            else if (m.clAge !== null && m.clAge >= 60) w.push({ f: 'Security', m: 'Adjudication > 5 Yrs old.', t: 'warning' });
            if (s.pme) s.pme.forEach(pme => { if (!sncoState.service.pmeComplete[pme]) w.push({ f: 'PME', m: `Requires ${pme} completion.`, t: 'error' }); });
            if (s.degree && !sncoState.service.degreeComplete) w.push({ f: 'Education', m: 'Requires CCAF.', t: 'error' });
            if (!sncoState.board.compositionMet) w.push({ f: 'Board', m: 'Not verified.', t: 'error' });
            const checks = [{id:'ca26',l:'CA ANG Form 26'},{id:'sou',l:'Service SOU (Att 3)'},{id:'memo',l:'Board Letter'},{id:'epb',l:'EPB'},{id:'fit',l:'Fitness Printout'},{id:'sec_clearance',l:'Sec Clearance Memo'},{id:'retrain_sou',l:'Retrain SOU',h:!isRetrain},{id:'first_sgt_sou',l:'1st Sgt SOU',h:!sncoState.isFirstSgt},{id:'af1206',l:'AF Form 1206',h:!isStep},{id:'bio',l:'Biography',h:!(isStep || isE8E9)},{id:'step2_sou',l:'STEP II SOU (Att 8)',h:!sncoState.profile.packageType !== 'STEP_II'}];
            checks.forEach(i => { if (!i.h && !sncoState.checklist[i.id]) w.push({ f: 'File', m: `Missing: ${i.l}.`, t: 'error' }); });
            return w;
        }

        function sncoRender() {
            try {
                const m = sncoGetMetrics();
                const s = standards[sncoState.profile.targetRank];
                const isAGR = sncoState.profile.component === 'AGR';
                const isE8E9 = ['SMSgt', 'CMSgt'].includes(sncoState.profile.targetRank);
                const reqSkill = s.skill;
                const pSkill = parseInt(sncoState.service.pafscLevel);
                const dSkill = parseInt(sncoState.service.dafscLevel);
                const isRetrain = (pSkill >= reqSkill && dSkill < reqSkill);
                const isStep = (sncoState.profile.packageType || "").startsWith('STEP');

                document.querySelectorAll('.snco-step').forEach((step, i) => { if (step) step.classList.toggle('hidden', i + 1 !== sncoState.currentStep); });
                
                const stepper = el('stepper-container');
                if (stepper) {
                    stepper.innerHTML = ["Identity", "Service", "Readiness", "Verification"].map((l, i) => `
                        <div class="flex flex-col items-center gap-2 flex-1 relative ${sncoState.currentStep >= i+1 ? 'text-blue-600' : 'text-slate-400'}">
                            <div class="w-10 h-10 rounded-full border-2 flex items-center justify-center font-bold transition-all ${sncoState.currentStep >= i+1 ? 'bg-blue-600 text-white border-blue-600' : 'bg-white border-slate-200'}">
                                ${sncoState.currentStep > i+1 ? '<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M5 13l4 4L19 7" stroke-linecap="round" stroke-linejoin="round" stroke-width="3"></path></svg>' : i+1}
                            </div>
                            <span class="text-[10px] font-black uppercase tracking-widest text-center">${l}</span>
                        </div>
                    `).join('');
                }

                if (el('tis-label')) el('tis-label').innerText = `Pay Entry Date (Pay Age: ${m.tis !== null ? formatYM(m.tis) : 'N/A'})`;
                if (el('tig-label')) el('tig-label').innerText = `Date of Rank (TIG: ${m.tig !== null ? formatYM(m.tig) : 'N/A'})`;
                if (el('epb-label')) el('epb-label').innerText = `Latest EPB Closeout Date`;
                if (el('logic-alerts')) el('logic-alerts').classList.toggle('hidden', !isRetrain);
                if (el('slot-req-badge')) el('slot-req-badge').innerText = `${reqSkill}-Level Required`;
                if (el('board-req-text')) el('board-req-text').innerText = isStep ? (s.stepComposition || s.composition) : s.composition;

                if (el('component-toggle')) {
                    el('component-toggle').innerHTML = ['DSG', 'AGR', 'Technician', 'Statutory Tour'].map(c => `
                        <button onclick="sncoUpdateField('profile', 'component', '${c}')" 
                                class="flex-1 py-3 text-[10px] font-black rounded-lg transition-all ${sncoState.profile.component === c ? 'bg-white text-blue-600 shadow-sm ring-1 ring-slate-200' : 'text-slate-500 hover:bg-white/50'}">
                            ${c}
                        </button>
                    `).join('');
                }

                const sContainer = el('tafms-container');
                if (sContainer) {
                    const y = isAGR ? sncoState.service.tafmsYears : sncoState.service.satYears;
                    const mon = isAGR ? sncoState.service.tafmsMonths : sncoState.service.satMonths;
                    const titleStr = isAGR ? "AGR Active Federal Service (TAFMS)" : "Satisfactory Service (NGB 23)";
                    const summaryStr = formatYM(isAGR ? m.tafms : m.sat);

                    const currentType = sContainer.getAttribute('data-type');
                    const targetType = isAGR ? 'AGR' : 'SAT';
                    
                    if (currentType !== targetType) {
                        sContainer.setAttribute('data-type', targetType);
                        sContainer.className = `p-6 rounded-[40px] space-y-4 shadow-xl border-4 transition-all min-h-[160px] flex flex-col justify-center ${isAGR ? 'bg-slate-900 border-blue-500 text-white' : 'bg-white border-slate-200 text-slate-900'}`;
                        sContainer.innerHTML = `
                            <div class="flex justify-between items-center border-b border-current opacity-60 pb-2">
                                <span class="text-[9px] font-black uppercase tracking-widest text-current">${titleStr}</span>
                                <span class="font-black text-xs italic" id="service-summary-display">${summaryStr}</span>
                            </div>
                            <div class="grid grid-cols-2 gap-4 mt-2">
                                <div>
                                    <label class="text-[9px] font-black uppercase text-current opacity-80 mb-1 block">Years</label>
                                    <input type="number" id="input-yrs" oninput="sncoUpdateServiceValue('Years', this.value)" 
                                        class="w-full rounded-xl p-3 text-xl font-black outline-none border-2 ${isAGR ? 'bg-slate-800 border-slate-600 !text-white' : 'bg-slate-50 border-slate-200 !text-slate-900 focus:bg-white focus:border-blue-500'}">
                                </div>
                                <div>
                                    <label class="text-[9px] font-black uppercase text-current opacity-80 mb-1 block">Months</label>
                                    <input type="number" id="input-mos" oninput="sncoUpdateServiceValue('Months', this.value)" 
                                        class="w-full rounded-xl p-3 text-xl font-black outline-none border-2 ${isAGR ? 'bg-slate-800 border-slate-600 !text-white' : 'bg-slate-50 border-slate-200 !text-slate-900 focus:bg-white focus:border-blue-500'}" max="11">
                                </div>
                            </div>
                        `;
                    }
                    const iy = el('input-yrs'); const im = el('input-mos');
                    if (iy && document.activeElement !== iy) iy.value = y;
                    if (im && document.activeElement !== im) im.value = mon;
                    if (el('service-summary-display')) el('service-summary-display').innerText = summaryStr;
                }

                if (el('row-ncoa')) el('row-ncoa').classList.toggle('hidden', isE8E9);
                const drawCheck = (id, state) => {
                    const box = el('check-' + id.toLowerCase());
                    if (box) {
                        box.innerHTML = state ? `<svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="5"><path d="M5 13l4 4L19 7"></path></svg>` : '';
                        box.className = `w-5 h-5 rounded-lg border-2 flex items-center justify-center transition-all ${state ? 'bg-blue-600 border-blue-600' : 'border-slate-600'}`;
                    }
                };
                drawCheck('NCOA', sncoState.service.pmeComplete.NCOA);
                drawCheck('SNCOA', sncoState.service.pmeComplete.SNCOA);
                drawCheck('Degree', sncoState.service.degreeComplete);

                if (el('admin-flags')) {
                    el('admin-flags').innerHTML = ['demotion', 'retirement', 'suspended'].map(id => `
                        <div class="flex items-center justify-between">
                            <span class="text-[10px] font-black text-slate-700 uppercase italic">${id === 'suspended' ? 'Legal/Hold' : id}?</span>
                            <button onclick="sncoToggleAdminHold('${id}')" class="w-12 h-6 rounded-full relative transition-all ${sncoState.readiness.adminHolds[id] ? 'bg-red-600' : 'bg-slate-300'}">
                                <div class="absolute top-1 w-4 h-4 bg-white rounded-full transition-all ${sncoState.readiness.adminHolds[id] ? 'left-7' : 'left-1'}"></div>
                            </button>
                        </div>
                    `).join('');
                }

                const auditRes = el('audit-results');
                const w = sncoGetWarnings();
                const isErr = w.some(item => item.t === 'error');
                const isWarn = w.some(item => item.t === 'warning');

                if (auditRes) {
                    if (w.length === 0) {
                        auditRes.innerHTML = `<div class="flex-1 flex flex-col items-center justify-center py-10 text-center animate-in fade-in"><div class="w-16 h-16 bg-green-50 rounded-full flex items-center justify-center mb-4 shadow-lg"><svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="3"><path d="M5 13l4 4L19 7"></path></svg></div><p class="text-[11px] font-black text-green-900 uppercase italic tracking-widest leading-none mt-2">Passed Compliance</p></div>`;
                        el('audit-summary-card').className = "mt-6 p-6 rounded-3xl border-2 bg-green-50 border-green-200 text-green-900 shrink-0 shadow-lg";
                        el('audit-summary-verdict').innerText = "PASS";
                    } else {
                        auditRes.innerHTML = w.map(item => `
                            <div class="p-4 rounded-2xl border flex gap-3 items-start animate-in zoom-in-95 ${item.t === 'error' ? 'bg-red-50 border-red-100 text-red-700' : 'bg-orange-50 border-orange-100 text-orange-700'}">
                                <i data-lucide="${item.t === 'error' ? 'shield-alert' : 'alert-circle'}" class="w-4 h-4 mt-0.5 shrink-0"></i>
                                <div><p class="text-[9px] font-black uppercase opacity-60 tracking-widest leading-none">${item.f}</p><p class="text-[10px] font-bold leading-tight">${item.m}</p></div>
                            </div>
                        `).join('');
                        el('audit-summary-card').className = `mt-6 p-6 rounded-3xl border-2 shrink-0 ${isErr ? 'bg-red-50 border-red-200 text-red-900' : (isWarn ? 'bg-orange-50 border-orange-200 text-orange-900' : 'bg-blue-50 border-blue-200 text-blue-900')}`;
                        el('audit-summary-verdict').innerText = isErr ? "FAIL" : (isWarn ? "CAUTION" : "PASS");
                    }
                }

                if (el('readiness-submissionDate')) el('readiness-submissionDate').value = sncoState.readiness.submissionDate;
                if (el('service-epbDate')) el('service-epbDate').value = sncoState.service.epbDate;
                if (el('clearance-input')) el('clearance-input').value = sncoState.readiness.clearanceDate;
                if (el('fit-currency-target') && m.fitTgt) el('fit-currency-target').innerText = `HQ Target Window: ${m.fitTgt.toLocaleDateString()}`;

                const clrInput = el('clearance-input');
                if (clrInput && m.clAge !== null && m.clAge >= 60) clrInput.className = "guidance-trigger w-full border-2 rounded-xl p-3 font-bold outline-none bg-orange-50 border-orange-400 !text-orange-900 shadow-inner";

                if (el('first-sgt-btn')) {
                    el('first-sgt-btn').innerText = `1st Sgt Mode: ${sncoState.isFirstSgt ? 'ACTIVE' : 'OFF'}`;
                    el('first-sgt-btn').className = `guidance-trigger px-4 py-2 rounded-xl text-[10px] font-black uppercase border-2 transition-all ${sncoState.isFirstSgt ? 'bg-red-600 border-red-600 text-white shadow-lg' : 'bg-white border-slate-200 text-slate-500'}`;
                }
                if (el('final-status-badge')) {
                    const badge = el('final-status-badge');
                    if (sncoState.currentStep < 4) { el('next-btn').classList.remove('hidden'); badge.classList.add('hidden'); }
                    else { el('next-btn').classList.add('hidden'); badge.classList.remove('hidden'); badge.innerText = isErr ? 'Blocked' : 'Validated'; badge.className = `px-10 py-3 rounded-xl font-black text-xs uppercase tracking-widest shadow-lg ${isErr ? 'bg-red-600 text-white' : 'bg-green-600 text-white'}`; }
                }

                if (sncoState.currentStep === 4 && el('folder-checklist')) {
                    const items = [{id:'ca26',l:'CA ANG Form 26'},{id:'sou',l:'Service SOU (Att 3)'},{id:'memo',l:'Board Letter'},{id:'epb',l:'EPB'},{id:'fit',l:'Fitness Printout'},{id:'sec_clearance',l:'Sec Clearance Memo'},{id:'retrain_sou',l:'Retrain SOU',h:!isRetrain},{id:'first_sgt_sou',l:'1st Sgt SOU',h:!sncoState.isFirstSgt},{id:'af1206',l:'AF Form 1206',h:!isStep},{id:'bio',l:'Biography',h:!(isStep || isE8E9)},{id:'step2_sou',l:'STEP II SOU (Att 8)',h:sncoState.profile.packageType !== 'STEP_II'}];
                    el('folder-checklist').innerHTML = items.filter(i=>!i.h).map(i=>`<div onclick="sncoToggleCheck('${i.id}')" class="h-16 p-3 rounded-2xl border-2 flex items-center justify-between cursor-pointer transition-all ${sncoState.checklist[i.id]?'bg-blue-600 border-blue-600 text-white shadow-lg':'bg-white border-slate-100'}"><span class="text-[9px] font-black uppercase tracking-tight leading-tight pr-2">${i.l}</span>${sncoState.checklist[i.id]?'<svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="4"><path d="M5 13l4 4L19 7" stroke-linecap="round" stroke-linejoin="round"></path></svg>':'<div class="w-4 h-4 rounded-full border-2 border-slate-200 shrink-0"></div>'}</div>`).join('');
                    if (el('board-comp-checkbox')) el('board-comp-checkbox').checked = sncoState.board.compositionMet;
                    if (el('rev-name')) el('rev-name').value = sncoState.reviewer.name;
                    if (el('rev-rank')) el('rev-rank').value = sncoState.reviewer.rank;
                    if (el('rev-unit')) el('rev-unit').value = sncoState.reviewer.unit;
                    if (el('rev-comments')) el('rev-comments').value = sncoState.reviewer.comments;
                }
                lucide.createIcons();
            } catch (err) { console.error("Render failure:", err); }
        }

        function openPrintPreview() {
            const m = sncoGetMetrics();
            const s = standards[sncoState.profile.targetRank];
            const isAGR = sncoState.profile.component === 'AGR';
            const warnings = sncoGetWarnings();
            const isErr = warnings.some(w => w.t === 'error');
            
            el('prev-name').innerText = sncoState.profile.name || "UNSPECIFIED";
            el('prev-rank').innerText = `${sncoState.profile.targetRank} (${sncoState.profile.packageType})`;
            el('prev-unit').innerText = sncoState.profile.unit || "UNSPECIFIED";
            el('prev-comments').innerText = sncoState.reviewer.comments || "NO REMARKS PROVIDED";
            el('prev-status').innerText = isErr ? 'REJECTED' : 'VALIDATED';
            el('prev-status').className = `text-xs font-black ${isErr ? 'text-red-600' : 'text-blue-600'}`;
            el('prev-reviewer-info').innerText = `${sncoState.reviewer.name || '____________'}, ${sncoState.reviewer.rank || '____'}, ${sncoState.reviewer.unit || '____'}`;

            const tableBody = el('prev-audit-table-body');
            const tisVal = isAGR ? m.tafms : m.sat;
            const pSkill = parseInt(sncoState.service.pafscLevel);

            const auditRows = [
                { label: `Service Eligibility (${isAGR ? 'TAFMS' : 'SAT'})`, evidence: `Actual: ${formatYM(tisVal)} / Req: ${s.tisLabel}`, status: tisVal >= s.minTis },
                { label: 'Time in Grade (TIG)', evidence: `Actual: ${m.tig !== null ? formatYM(m.tig) : 'N/A'} / Req: 2 Yrs`, status: m.tig >= 24 || sncoState.profile.targetRank.startsWith('T') },
                { label: 'Job Qualification (PAFSC)', evidence: `Level: ${pSkill} / Required: ${s.skill}`, status: pSkill >= s.skill },
                { label: 'Performance Cycle (EPB)', evidence: `Age: ${m.epbAge !== null ? m.epbAge + ' Mos' : 'N/A'}`, status: m.epbAge !== null && m.epbAge <= (isAGR ? 12 : 24) },
                { label: 'Fitness Standards', evidence: `Score: ${sncoState.readiness.fitScore || '0'}`, status: sncoState.readiness.fitStatus !== 'Failing' && (sncoState.readiness.fitStatus === 'Exempt' || parseFloat(sncoState.readiness.fitScore) >= 75) },
                { label: 'Security Adjudication', evidence: `Age: ${m.clAge !== null ? m.clAge + ' Mos' : 'N/A'}`, status: sncoState.readiness.clearanceDate && m.clAge < 60 },
                { label: 'Package Verification', evidence: 'Audit of folder checklist', status: warnings.filter(w=>w.f==='File' || w.f === 'Incomplete').length === 0 }
            ];

            tableBody.innerHTML = auditRows.map(row => `
                <tr>
                    <td class="px-4 py-2 font-bold">${row.label}</td>
                    <td class="px-4 py-2 text-slate-500 italic">${row.evidence}</td>
                    <td class="px-4 py-2 text-center">${row.status ? '<span class="text-green-600 font-black"></span>' : '<span class="text-red-600 font-black"></span>'}</td>
                </tr>
            `).join('');
            el('print-modal').classList.remove('hidden');
        }

        function closePrintPreview() { el('print-modal').classList.add('hidden'); }

        window.onload = function() { 
            setupGuidanceSystem(); 
            sncoRender(); 
        }
    </script>
</body>
</html>
